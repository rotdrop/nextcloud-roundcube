"use strict";(self.webpackChunkmail_roundcube=self.webpackChunkmail_roundcube||[]).push([["src_RoundCubeWrapper_vue"],{69132:(e,r,t)=>{t.r(r),t.d(r,{default:()=>c});var o=t(85471),a=t(81827),n=t(53334);var l=t(47635);const i=(0,o.pM)({__name:"RoundCubeWrapper",props:{externalLocation:null,fullScreen:{type:Boolean,default:!0},hideTopLine:{type:Boolean,default:!0},query:{default:()=>({_task:"mail"})}},emits:["iframe-loaded","iframe-resize","update-loading","error"],setup(e,r){let{expose:t,emit:i}=r;const c=e,u="RoundCube",s=(0,o.KR)(!0);(0,o.wB)(s,(e=>i("update-loading",e)));const d=(0,o.EW)((()=>new URLSearchParams(c.query).toString())),p=(0,o.EW)((()=>c.externalLocation+"/"+(d.value?"?"+d.value:""))),m=(0,o.KR)(p.value),v=(0,o.KR)(p.value),f=(0,o.EW)((()=>a.J+"-frame"));(0,o.wB)(d,(e=>{p.value!==v.value?(l.A.debug("TRIGGER IFRAME REFRESH",{request:p.value,current:v.value}),s.value=!0,m.value=p.value):l.A.debug("NOT CHANGING IFRAME SOURCE",{request:p.value,current:v.value})}));const E=1e3;let h,g=0;const b=(0,o.KR)(null),w=(0,o.KR)(null),y=(0,o.KR)(null),R=(0,o.KR)(null);let A;const S=e=>{let{width:r,height:t}=e;if(!R.value)return;const o=R.value;o.style.width=r+"px",o.style.height=t+"px"},T=new ResizeObserver((e=>{for(const r of e)r.target!==A?c.fullScreen&&r.target===b.value&&S(r.contentRect):i("iframe-resize",r)})),C=new MutationObserver((e=>{l.A.info("MUTATION OBSERVED",{entries:e});const r=R.value;L(r)})),F=e=>{w.value.classList.toggle("fading",!0),i("error",{error:e instanceof Error?e:new Error("Non-error error",{cause:e}),hint:(0,n.Tl)(a.J,"Unable to access the contents of the wrapped {wrappedApp} instance.\nThis may be caused by cross-domain access restrictions.\nPlease check that your Nextcloud instance ({nextcloudUrl}) and the wrapped {wrappedApp} instance ({iFrameUrl}) are served from the same domain.",{nextcloudUrl:window.location.protocol+"//"+window.location.host,iFrameUrl:c.externalLocation||"",wrappedApp:u})})},L=e=>{const r=e.contentWindow,t=e.contentDocument;v.value=r.location.href;const o=r.location.search,a=Object.fromEntries(new URLSearchParams(o).entries());i("iframe-loaded",{query:a,iFrame:e,window:r,document:t})},N=()=>{if(h=void 0,s.value){g++;try{R.value.contentWindow.document.querySelector("#layout")?(l.A.debug("ROUNDCUBE: LOAD EVENT FROM TIMER AFTER "+E*g+" ms"),R.value.dispatchEvent(new Event("load"))):h=setTimeout(N,E)}catch(e){l.A.error("UNABLE TO ACCESS IFRAME CONTENTS",{error:e}),F(e)}}};return(0,o.KC)((()=>{s.value=!0,m.value=p.value})),(0,o.wB)((()=>c.fullScreen),(e=>{if(e){const e=R.value;e&&(m.value!==p.value?m.value=p.value:e.contentWindow&&(e.contentWindow.location.href=p.value))}})),(0,o.sV)((()=>{h||(h=setTimeout(N,E)),T.observe(b.value)})),(0,o.xo)((()=>{T.disconnect(),C.disconnect()})),t({currentLocation:v,redaxoIFrame:R}),{__sfc:!0,wrappedApp:u,props:c,emit:i,loading:s,queryString:d,requestedLocation:p,iFrameLocation:m,currentLocation:v,frameId:f,loadTimeout:E,timerCount:g,loadTimer:h,container:b,loaderContainer:w,frameWrapper:y,externalFrame:R,iFrameBody:A,setIFrameSize:S,resizeObserver:T,contentObserver:C,emitError:F,emitLoaded:L,loadHandler:()=>{l.A.debug("GOT LOAD EVENT");const e=R.value,r=e?.contentWindow;if(!e||!r)return;let t;s.value=!0;try{t=e.contentDocument}catch(e){return l.A.error("UNABLE TO ACCESS IFRAME CONTENTS",{error:e}),void F(e)}c.hideTopLine&&(e=>{const r=e.contentWindow,t=r.document,o=r.rcmail.env.skin;if(o.includes("classic"))t.querySelectorAll(".button-logout").forEach((e=>e.remove()));else if(o.includes("elastic"))t.querySelectorAll(":scope .special-buttons .logout").forEach((e=>e.remove()));else if(o.includes("larry")){const e=t.querySelector("#mainscreen"),r=t.querySelector("#topline").getBoundingClientRect().height,o=40;let a=parseInt(e.style.top)-r;t.querySelector("#topline").remove(),e.querySelector(".toolbar")||(a-=o),e.style.top=a+"px",t.querySelector(":scope #taskbar .minmodetoggle").remove(),t.querySelector("#taskbar").style["padding-right"]=0,t.querySelector(".button-logout").remove()}})(e),c.fullScreen&&S(b.value.getBoundingClientRect()),A=t?.body,l.A.debug("IFRAME BODY",{iFrameBody:A}),A&&(T.observe(A),C.observe(A,{childList:!0,subtree:!0})),w.value.classList.toggle("fading",!0),l.A.debug("IFRAME IS NOW",{iFrame:e,location:r.location}),L(e),s.value=!1},loadTimerHandler:N,appName:a.J}}});const c=(0,t(14486).A)(i,(function(){var e=this,r=e._self._c,t=e._self._setupProxy;return r("div",{ref:"container",class:t.appName+"-container"},[r("div",{ref:"loaderContainer",staticClass:"loader-container"}),e._v(" "),r("div",{ref:"frameWrapper",class:t.appName+"-frame-wrapper"},[r("iframe",{ref:"externalFrame",attrs:{id:t.frameId,src:t.iFrameLocation,name:t.appName},on:{load:t.loadHandler}})])])}),[],!1,null,"586249c2",null).exports}}]);
//# sourceMappingURL=src_RoundCubeWrapper_vue-e7911c8d862a07f4d50b.js.map